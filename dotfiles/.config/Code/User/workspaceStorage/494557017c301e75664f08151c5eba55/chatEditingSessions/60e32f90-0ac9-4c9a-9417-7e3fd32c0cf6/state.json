{"version":2,"sessionId":"60e32f90-0ac9-4c9a-9417-7e3fd32c0cf6","initialFileContents":[["file:///home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/pacman.conf","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf","da39a3e"],["file:///home/ali/myarchiso/build.sh","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","da39a3e"],["file:///home/ali/myarchiso/hyprland-releng-custom/README.md","da39a3e"]],"timeline":{"checkpoints":[{"checkpointId":"bc8c6ae7-6221-4db1-a800-4b74371a4077","epoch":0,"label":"Initial State","description":"Starting point before any edits"},{"checkpointId":"9f03b07d-9501-44ff-9ecc-443bb38fa6fa","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":1,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9"},{"checkpointId":"df6546ca-b091-4b73-a164-96e56825c3c3","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"f0f8e803-9770-4c4d-9823-fb7d812bbc42","epoch":2,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop f0f8e803-9770-4c4d-9823-fb7d812bbc42"},{"checkpointId":"15073b76-c6d0-49ab-b624-0c1f22bfbb25","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"8ac49cc6-27a5-4202-b7c7-ba3dc2fd6873","epoch":6,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop 8ac49cc6-27a5-4202-b7c7-ba3dc2fd6873"},{"checkpointId":"9c4c26c2-25ef-4701-ab50-98861e8595a2","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"cf00c6d4-de12-4eec-b80b-f1df01bdcade","epoch":10,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop cf00c6d4-de12-4eec-b80b-f1df01bdcade"},{"checkpointId":"c563e311-cb47-413b-ae0a-be0ff306cf76","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"c3cc522b-9dc4-4e71-946d-51872ed8936a","epoch":14,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop c3cc522b-9dc4-4e71-946d-51872ed8936a"},{"checkpointId":"cd1a55a4-aaf4-4867-9d52-b63520f2a711","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"03f053bc-b0d9-46fa-ac0f-f3c8da5c65ba","epoch":18,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop 03f053bc-b0d9-46fa-ac0f-f3c8da5c65ba"},{"checkpointId":"8ffe0f21-1c68-47ca-ae96-8507fbbf1298","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"f1992514-a9bd-4d37-971e-f1a72c17218c","epoch":22,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop f1992514-a9bd-4d37-971e-f1a72c17218c"},{"checkpointId":"967d6170-37d4-4e7f-a21f-665a58eb8841","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"d838d822-fdf2-4981-b4ce-7a68c212917b","epoch":26,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop d838d822-fdf2-4981-b4ce-7a68c212917b"},{"checkpointId":"dfe77182-ec21-438b-b304-14292701d82d","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"af55dc8e-4a61-4c22-a6a1-61bafe0856bd","epoch":30,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop af55dc8e-4a61-4c22-a6a1-61bafe0856bd"},{"checkpointId":"b08e579d-a834-4033-bd6b-8579d161b262","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"352659f7-6360-47ba-b98c-712c805624bb","epoch":34,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop 352659f7-6360-47ba-b98c-712c805624bb"},{"checkpointId":"061b331d-6678-43db-a5b8-3f399b4b8c77","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"b9588ede-4b9f-4c29-8d1f-fe43d736dbef","epoch":38,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop b9588ede-4b9f-4c29-8d1f-fe43d736dbef"},{"checkpointId":"887e3510-fe0a-4303-99a8-904f538fefa1","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"7f1d03d8-58d1-42fb-8ffc-cd921d9c3048","epoch":42,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop 7f1d03d8-58d1-42fb-8ffc-cd921d9c3048"},{"checkpointId":"f391f92f-5eae-432a-b930-64d3f540c57d","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"087b56d0-9346-4b4c-b3b5-94704aafd465","epoch":46,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop 087b56d0-9346-4b4c-b3b5-94704aafd465"},{"checkpointId":"4d6e6cd2-0223-4b3e-b012-8cc75df4a9af","requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","undoStopId":"0e066d15-740f-4c4c-bef4-241eb23992b3","epoch":50,"label":"Request request_2bb05cc1-ab15-4efb-9180-10303c251cd9 - Stop 0e066d15-740f-4c4c-bef4-241eb23992b3"},{"checkpointId":"72ae7485-add8-4e22-bb0f-7912cdd37df5","requestId":"request_7801c6d1-14ed-45a3-891a-26886e301da7","epoch":54,"label":"Request request_7801c6d1-14ed-45a3-891a-26886e301da7"},{"checkpointId":"a361e8b9-d0b7-4a25-ad21-13094821f0e3","requestId":"request_a2deb1c3-dc0f-4f32-b05d-5ba703961279","epoch":55,"label":"Request request_a2deb1c3-dc0f-4f32-b05d-5ba703961279"}],"currentEpoch":56,"fileBaselines":[["file:///home/ali/myarchiso/hyprland-releng-custom/packages.x86_64::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","external":"file:///home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","path":"/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":4,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/pacman.conf::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/pacman.conf","external":"file:///home/ali/myarchiso/hyprland-releng-custom/pacman.conf","path":"/home/ali/myarchiso/hyprland-releng-custom/pacman.conf","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":8,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/profiledef.sh::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":12,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":16,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":20,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":24,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":28,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":32,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":36,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":40,"telemetryInfo":{}}],["file:///home/ali/myarchiso/build.sh::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/build.sh","external":"file:///home/ali/myarchiso/build.sh","path":"/home/ali/myarchiso/build.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":44,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":48,"telemetryInfo":{}}],["file:///home/ali/myarchiso/hyprland-releng-custom/README.md::request_2bb05cc1-ab15-4efb-9180-10303c251cd9",{"uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/README.md","external":"file:///home/ali/myarchiso/hyprland-releng-custom/README.md","path":"/home/ali/myarchiso/hyprland-releng-custom/README.md","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","content":"","epoch":52,"telemetryInfo":{}}]],"operations":[{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","external":"file:///home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","path":"/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":3,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","external":"file:///home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","path":"/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":5,"edits":[{"text":"# Core system\nbase\nlinux\nlinux-firmware\n\n# Bootloader & partitioning\ngrub\nefibootmgr\ndosfstools\ne2fsprogs\n\n# Networking\nnetworkmanager\nnetwork-manager-applet\nnm-connection-editor\nwpa_supplicant\nopenssh\n\n# Utilities\nsudo\ndialog\nbash-completion\nbase-devel\npolkit\nelogind\ndbus\npam\n\n# Wayland & Hyprland stack\nwayland\nwayland-protocols\nwlroots\nhyprland\nhyprpaper\nxdg-desktop-portal\nxdg-desktop-portal-wlr\n\n# Audio\npipewire\npipewire-alsa\npipewire-pulse\nwireplumber\nalsa-utils\n\n# Clipboard / screenshots / launcher / notifications\nwl-clipboard\ngrim\nslurp\nmako\nwofi\n\n# Terminals and tools\nkitty\nfoot\n\n# Fonts (used by end-4 dotfiles)\nttf-jetbrains-mono\nttf-font-awesome\nnoto-fonts\n\n# Additional niceties\nxdg-utils\npolkit-gnome\nntfs-3g\nmkinitcpio\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/pacman.conf","external":"file:///home/ali/myarchiso/hyprland-releng-custom/pacman.conf","path":"/home/ali/myarchiso/hyprland-releng-custom/pacman.conf","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":7,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/pacman.conf","external":"file:///home/ali/myarchiso/hyprland-releng-custom/pacman.conf","path":"/home/ali/myarchiso/hyprland-releng-custom/pacman.conf","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":9,"edits":[{"text":"# Minimal pacman.conf for the live environment and installed systems to use\n# This file is intended to live inside the ISO's airootfs and be copied into\n# installed systems by the installer. It enables a local file-backed repo\n# named \"hyprland_iso\" which points to a directory on the ISO that will\n# contain all required .pkg.tar.zst files and the repo db.\n\n[options]\nHoldPkg     = pacman glibc\nArchitecture = auto\n\n[core]\nInclude = /etc/pacman.d/mirrorlist\n\n[extra]\nInclude = /etc/pacman.d/mirrorlist\n\n[community]\nInclude = /etc/pacman.d/mirrorlist\n\n# Local repository stored on the ISO root at /hyprland_repo\n[hyprland_iso]\nServer = file:///hyprland_repo\nSigLevel = Optional TrustAll\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":11,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":13,"edits":[{"text":"#!/usr/bin/env bash\n# Profile definition for mkarchiso\n# name used when invoking mkarchiso\nprofile_name=\"hyprland-releng-custom\"\n\n# Optionally set a build label\niso_name=\"hyprland-live-custom\"\n\n# Keep default settings (these variables are read by mkarchiso)\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":15,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":17,"edits":[{"text":"#!/usr/bin/env bash\nset -euo pipefail\n# This script is executed by mkarchiso while building the image. It runs\n# inside the airootfs chroot. We use it to create the `live` user (UID 1000),\n# bake in the end-4 dotfiles and enable services.\n\necho \"==> customize_airootfs: creating live user and installing dotfiles\"\n\n# Create wheel group if it doesn't exist\ngetent group wheel >/dev/null || groupadd -r wheel\n\n# Create user 'live' with UID 1000 (if not exists)\nif ! id -u live >/dev/null 2>&1; then\n  useradd -m -u 1000 -G wheel -s /bin/bash live\n  passwd -d live || true\nfi\n\n# Ensure sudoers for wheel group\nif ! grep -q \"^%wheel ALL=(ALL) ALL\" /etc/sudoers 2>/dev/null; then\n  echo \"%wheel ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers\nfi\n\n# Clone end-4 dotfiles into /usr/share/hyprland-dotfiles and copy to /etc/skel\nDOTS_REPO=\"https://github.com/end-4/dots-hyprland\"\nDEST_SHARE=\"/usr/share/hyprland-dotfiles\"\nSKEL_DIR=\"/etc/skel\"\n\nif [ -d \"${DEST_SHARE}\" ]; then\n  rm -rf \"${DEST_SHARE}\"\nfi\n\necho \"==> Cloning dotfiles from ${DOTS_REPO} (build-time)\"\nif command -v git >/dev/null 2>&1; then\n  git clone --depth 1 \"${DOTS_REPO}\" \"${DEST_SHARE}\" || true\nfi\n\n# If clone failed (no network), allow builder to have pre-fetched tarball next to build script\nif [ ! -d \"${DEST_SHARE}\" ] && [ -f \"/root/dots-hyprland.tar.gz\" ]; then\n  mkdir -p \"${DEST_SHARE}\"\n  tar -xzf /root/dots-hyprland.tar.gz -C \"${DEST_SHARE}\"\nfi\n\nif [ -d \"${DEST_SHARE}\" ]; then\n  mkdir -p \"${SKEL_DIR}/.config\"\n  cp -a \"${DEST_SHARE}/.config\" \"${SKEL_DIR}/\" 2>/dev/null || true\n  cp -a \"${DEST_SHARE}/wallpapers\" \"/usr/share/hyprland-wallpapers\" 2>/dev/null || true\n  chown -R 1000:100 \"${SKEL_DIR}/.config\" || true\nfi\n\n# Install helper scripts into /usr/local/bin in the image\ncp -a /usr/local/bin/install_end4_dotfiles.sh /usr/local/bin/install_end4_dotfiles.sh || true\ncp -a /usr/local/bin/hyprland-offline-installer /usr/local/bin/hyprland-offline-installer || true\nchmod +x /usr/local/bin/install_end4_dotfiles.sh /usr/local/bin/hyprland-offline-installer || true\n\n# Enable systemd services by creating symlinks in the proper wants directories\nmkdir -p /etc/systemd/system/graphical.target.wants\nmkdir -p /etc/systemd/system/multi-user.target.wants\nif [ -f /usr/lib/systemd/system/hyprland-live.service ]; then\n  ln -sf /usr/lib/systemd/system/hyprland-live.service /etc/systemd/system/graphical.target.wants/hyprland-live.service\nfi\nif [ -f /usr/lib/systemd/system/hyprland-installer.service ]; then\n  ln -sf /usr/lib/systemd/system/hyprland-installer.service /etc/systemd/system/multi-user.target.wants/hyprland-installer.service\nfi\n\necho \"==> customize_airootfs finished\"\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":19,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":21,"edits":[{"text":"#!/usr/bin/env bash\nset -euo pipefail\n# install_end4_dotfiles.sh\n# Usage: run as root to copy baked dotfiles into a target root (e.g., / or /mnt)\n# This script is installed both in the live image and within installed systems by\n# the installer. It supports an optional argument: target root path (default \"/\").\n\nTARGET_ROOT=\"${1:-/}\"\n\necho \"Installing end-4 hyprland dotfiles into ${TARGET_ROOT}\"\n\nSRC=\"/usr/share/hyprland-dotfiles\"\nif [ ! -d \"${SRC}\" ]; then\n  echo \"No baked dotfiles found at ${SRC}. Aborting.\" >&2\n  exit 1\nfi\n\n# Copy into /etc/skel so future users get them\nmkdir -p \"${TARGET_ROOT}/etc/skel\"\ncp -a \"${SRC}/.config\" \"${TARGET_ROOT}/etc/skel/\" 2>/dev/null || true\n\n# Copy wallpapers/icons into /usr/share\nif [ -d \"${SRC}/wallpapers\" ]; then\n  mkdir -p \"${TARGET_ROOT}/usr/share/hyprland-wallpapers\"\n  cp -a \"${SRC}/wallpapers\" \"${TARGET_ROOT}/usr/share/hyprland-wallpapers/\"\nfi\n\n# If run inside a chroot for a specific user, copy dotfiles into that user's home\nif [ -n \"${SUDO_USER:-}\" ]; then\n  TARGET_USER_HOME=\"$((getent passwd \"${SUDO_USER}\" | cut -d: -f6) ?: /home/${SUDO_USER})\"\n  if [ -d \"${TARGET_USER_HOME}\" ]; then\n    mkdir -p \"${TARGET_USER_HOME}/.config\"\n    cp -a \"${SRC}/.config\" \"${TARGET_USER_HOME}/.config/\" 2>/dev/null || true\n    chown -R \"${SUDO_USER}:\" \"${TARGET_USER_HOME}/.config\" || true\n  fi\nfi\n\necho \"Dotfiles installation complete.\"\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":23,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":25,"edits":[{"text":"#!/usr/bin/env bash\nset -euo pipefail\n# start-hyprland.sh\n# Simple wrapper to launch Hyprland for the live user on tty1.\n\nexport XDG_RUNTIME_DIR=\"/run/user/1000\"\nmkdir -p \"$XDG_RUNTIME_DIR\"\nchown 1000:100 \"$XDG_RUNTIME_DIR\" || true\n\nexec runuser -l live -c 'dbus-run-session --suppress-output -- hyprland'\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":27,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":29,"edits":[{"text":"#!/usr/bin/env bash\nset -euo pipefail\n# hyprland-offline-installer\n# An interactive, dialog-based offline installer for the Hyprland live image.\n# This script is intentionally linear and verbose with clear steps and rollback\n# checkpoints. It assumes a local package repository is available at /hyprland_repo\n# on the live environment (created during build). It also supports command-line\n# flags for unattended defaults: --locale, --keymap, --timezone.\n\nTMP_LOG=\"/tmp/hyprland-installer.log\"\necho \"Starting hyprland-offline-installer\" > \"$TMP_LOG\"\n\ndie(){ echo \"$*\" | tee -a \"$TMP_LOG\"; exit 1; }\n\nusage(){\n  cat <<EOF\nUsage: $0 [--locale <LOCALE>] [--keymap <KEYMAP>] [--timezone <TZ>]\nEOF\n  exit 1\n}\n\nLOCALE_ARG=\"\"\nKEYMAP_ARG=\"\"\nTZ_ARG=\"\"\n\nwhile [ \"$#\" -gt 0 ]; do\n  case \"$1\" in\n    --locale) LOCALE_ARG=\"$2\"; shift 2;;\n    --keymap) KEYMAP_ARG=\"$2\"; shift 2;;\n    --timezone) TZ_ARG=\"$2\"; shift 2;;\n    -h|--help) usage;;\n    *) break;;\n  esac\ndone\n\n# check for dialog\nif ! command -v dialog >/dev/null 2>&1; then\n  echo \"dialog is required for the TUI. Install it in the live image.\" | tee -a \"$TMP_LOG\"\n  exit 1\nfi\n\nTEMPFILE=\"/tmp/hyprland.installer.tmp\"\n\nshow_msg(){ dialog --title \"$1\" --msgbox \"$2\" 12 60; }\n\nask_keyboard(){\n  if [ -n \"$KEYMAP_ARG\" ]; then\n    loadkeys \"$KEYMAP_ARG\" || true\n    echo \"$KEYMAP_ARG\" > /tmp/inst-keymap\n    return\n  fi\n  dialog --menu \"Choose keymap\" 12 50 6 \\\n    us \"US\" \\\n    uk \"UK\" \\\n    de \"German\" \\\n    fr \"French\" \\\n    ar \"Arabic\" 2> \"$TEMPFILE\"\n  rc=$?\n  [ $rc -ne 0 ] && die \"Cancelled\"\n  KEY=$(cat \"$TEMPFILE\")\n  case \"$KEY\" in\n    us) loadkeys us; echo us > /tmp/inst-keymap;;\n    uk) loadkeys uk; echo uk > /tmp/inst-keymap;;\n    de) loadkeys de; echo de > /tmp/inst-keymap;;\n    fr) loadkeys fr; echo fr > /tmp/inst-keymap;;\n    ar) loadkeys ar; echo ar > /tmp/inst-keymap;;\n  esac\n}\n\nask_locale(){\n  if [ -n \"$LOCALE_ARG\" ]; then\n    echo \"$LOCALE_ARG\" > /tmp/inst-locale\n    return\n  fi\n  dialog --menu \"Choose locale\" 14 60 6 \\\n    en_US.UTF-8 \"English (US)\" \\\n    en_GB.UTF-8 \"English (UK)\" \\\n    fr_FR.UTF-8 \"French\" \\\n    de_DE.UTF-8 \"German\" \\\n    ar_SA.UTF-8 \"Arabic (Saudi)\" 2> \"$TEMPFILE\"\n  rc=$?\n  [ $rc -ne 0 ] && die \"Cancelled\"\n  cat \"$TEMPFILE\" > /tmp/inst-locale\n}\n\nask_timezone(){\n  if [ -n \"$TZ_ARG\" ]; then\n    echo \"$TZ_ARG\" > /tmp/inst-tz\n    return\n  fi\n  dialog --inputbox \"Enter timezone (e.g. Europe/Berlin or Asia/Riyadh):\" 8 60 Asia/Riyadh 2> \"$TEMPFILE\"\n  rc=$?\n  [ $rc -ne 0 ] && die \"Cancelled\"\n  cat \"$TEMPFILE\" > /tmp/inst-tz\n}\n\nask_hostname_user(){\n  dialog --inputbox \"Hostname for the installed system:\" 8 40 hyprland 2> \"$TEMPFILE\" || die \"Cancelled\"\n  cat \"$TEMPFILE\" > /tmp/inst-hostname\n  dialog --inputbox \"Username to create (non-root):\" 8 40 user 2> \"$TEMPFILE\" || die \"Cancelled\"\n  cat \"$TEMPFILE\" > /tmp/inst-username\n  dialog --passwordbox \"Password for the new user (will be set on installed system):\" 8 40 2> \"$TEMPFILE\" || die \"Cancelled\"\n  cat \"$TEMPFILE\" > /tmp/inst-user-pass\n}\n\nchoose_disk(){\n  # List candidate disks (sd*, nvme*)\n  mapfile -t DISKS < <(lsblk -dn -o NAME,TYPE | awk '$2==\"disk\"{print \"/dev/\"$1}')\n  if [ ${#DISKS[@]} -eq 0 ]; then\n    die \"No block devices found\"\n  fi\n  i=1; menu=\"\"\n  for d in \"${DISKS[@]}\"; do\n    size=$(lsblk -dn -o SIZE \"$d\")\n    menu+=\"$d\" \"Size: $size\" \\\n  done\n  dialog --menu \"Choose target disk (all data will be destroyed)\" 14 60 8 ${DISKS[@]} 2> \"$TEMPFILE\" || die \"Cancelled\"\n  cat \"$TEMPFILE\" > /tmp/inst-disk\n}\n\nconfirm_danger(){\n  dialog --yesno \"About to format ${1} and create partitions - THIS WILL ERASE ALL DATA ON THE SELECTED DISK. Type YES to proceed.\" 12 60\n  rc=$?\n  [ $rc -ne 0 ] && die \"User aborted\"\n}\n\ndo_partition_and_format(){\n  DISK=$(cat /tmp/inst-disk)\n  # Guided: GPT, 512MB EFI, rest ext4\n  confirm_danger \"$DISK\"\n  parted -s \"$DISK\" mklabel gpt\n  parted -s \"$DISK\" mkpart primary fat32 1MiB 513MiB\n  parted -s \"$DISK\" mkpart primary ext4 513MiB 100%\n  parted -s \"$DISK\" set 1 esp on\n  sleep 1\n  # Resolve partitions names (nvme vs sdX)\n  if [[ \"$DISK\" =~ nvme ]]; then\n    EFI=\"${DISK}p1\"\n    ROOT=\"${DISK}p2\"\n  else\n    EFI=\"${DISK}1\"\n    ROOT=\"${DISK}2\"\n  fi\n  mkfs.fat -F32 \"$EFI\"\n  mkfs.ext4 -F \"$ROOT\"\n  mkdir -p /mnt\n  mount \"$ROOT\" /mnt\n  mkdir -p /mnt/boot/efi\n  mount \"$EFI\" /mnt/boot/efi\n}\n\nconfigure_pacman_localrepo_in_chroot(){\n  # Append local repo to pacman.conf inside the target root to allow offline install\n  cat >> /mnt/etc/pacman.conf <<'EOF'\n[hyprland_iso]\nServer = file:///hyprland_repo\nSigLevel = Optional TrustAll\nEOF\n}\n\ninstall_base_system(){\n  # Use pacstrap with local repo; pacstrap will need to find packages.\n  # Ensure the live environment has /hyprland_repo available (built into ISO)\n  if [ ! -d /hyprland_repo ]; then\n    show_msg \"Repository not found\" \"Local package repository '/hyprland_repo' not found on the live image. Installation cannot proceed offline.\"\n    die \"Missing /hyprland_repo\"\n  fi\n\n  # Copy pacman config to target and add repo\n  mkdir -p /mnt/etc\n  cp /etc/pacman.conf /mnt/etc/pacman.conf\n  configure_pacman_localrepo_in_chroot\n\n  # Use pacstrap to install packages from the ISO-local repo\n  pacstrap -C /mnt/etc/pacman.conf /mnt base base-devel linux linux-firmware \"@core\"\n  # Also install packages listed in a packages list file if present\n  if [ -f /hyprland_packages_list.txt ]; then\n    PKGS=$(cat /hyprland_packages_list.txt | tr '\\n' ' ')\n    pacstrap -C /mnt/etc/pacman.conf /mnt $PKGS\n  fi\n}\n\nfinalize_install(){\n  # fstab\n  genfstab -U /mnt >> /mnt/etc/fstab\n\n  # chroot and set hostname, locale, timezone, user\n  HOSTNAME=$(cat /tmp/inst-hostname)\n  LOCALE=$(cat /tmp/inst-locale)\n  TZ=$(cat /tmp/inst-tz)\n  UNAME=$(cat /tmp/inst-username)\n  UPASS=$(cat /tmp/inst-user-pass)\n\n  arch-chroot /mnt /bin/bash -e <<EOF\nset -e\necho \"$HOSTNAME\" > /etc/hostname\nln -sf /usr/share/zoneinfo/$TZ /etc/localtime || true\necho \"$LOCALE\" > /etc/locale.conf\nsed -n '1p' /etc/locale.gen >/dev/null 2>&1 || true\nif ! grep -q \"^$LOCALE\" /etc/locale.gen 2>/dev/null; then\n  echo \"$LOCALE UTF-8\" >> /etc/locale.gen\nfi\nlocale-gen || true\nmkinitcpio -P || true\n\n# Install grub for UEFI\ngrub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB || true\ngrub-mkconfig -o /boot/grub/grub.cfg || true\n\n# create user and set password\nuseradd -m -G wheel -s /bin/bash \"$UNAME\" || true\necho \"$UNAME:$UPASS\" | chpasswd || true\necho \"%wheel ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers\n\n# Enable NetworkManager\nsystemctl enable NetworkManager\n\nEOF\n}\n\ncopy_dotfiles_to_installed(){\n  if [ -d /usr/share/hyprland-dotfiles ]; then\n    cp -a /usr/share/hyprland-dotfiles /mnt/usr/share/ || true\n    arch-chroot /mnt /usr/local/bin/install_end4_dotfiles.sh / || true\n  fi\n}\n\ncleanup_and_finish(){\n  # Disable the installer service inside installed system so it doesn't auto-run\n  arch-chroot /mnt /bin/bash -c 'systemctl disable hyprland-installer.service || true'\n  umount -R /mnt || true\n  show_msg \"Installation finished\" \"Installation complete. You may reboot into your new system.\"\n}\n\n# Main flow\nshow_msg \"Welcome\" \"Welcome to the Hyprland offline installer. The installer will guide you through keyboard, locale, timezone, partitioning and a minimal installation from the ISO-local repo.\"\nask_keyboard\nask_locale\nask_timezone\nask_hostname_user\nchoose_disk\ndo_partition_and_format\ninstall_base_system\nfinalize_install\ncopy_dotfiles_to_installed\ncleanup_and_finish\n\nexit 0\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":31,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":33,"edits":[{"text":"[Unit]\nDescription=Hyprland live session autostart\nAfter=systemd-user-sessions.service\nWants=network-online.target\n\n[Service]\nType=simple\nUser=live\nEnvironment=DISPLAY=:0\nExecStart=/usr/local/bin/start-hyprland.sh\nRestart=on-failure\n\n[Install]\nWantedBy=graphical.target\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":35,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":37,"edits":[{"text":"[Unit]\nDescription=Launch Hyprland offline installer for live session (oneshot)\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=oneshot\nUser=live\nExecStart=/usr/local/bin/hyprland-offline-installer\nRemainAfterExit=yes\n\n[Install]\nWantedBy=multi-user.target\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":39,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":41,"edits":[{"text":"[Service]\nExecStart=\nExecStart=-/sbin/agetty --autologin live --noclear %I $TERM\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/build.sh","external":"file:///home/ali/myarchiso/build.sh","path":"/home/ali/myarchiso/build.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":43,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/build.sh","external":"file:///home/ali/myarchiso/build.sh","path":"/home/ali/myarchiso/build.sh","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":45,"edits":[{"text":"#!/usr/bin/env bash\nset -euo pipefail\n# build.sh - build the Hyprland archiso\n# This script validates prerequisites, prepares a local repo of packages and\n# invokes mkarchiso to build an ISO using the `hyprland-releng-custom` profile.\n\nPROFILE_DIR=\"hyprland-releng-custom\"\nWORKDIR=\"work\"\nOUTDIR=\"out\"\n\nreqs=(mkarchiso bsdtar xorriso repo-add pacman)\nmissing=()\nfor p in \"${reqs[@]}\"; do\n  if ! command -v \"$p\" >/dev/null 2>&1; then\n    missing+=($p)\n  fi\ndone\nif [ ${#missing[@]} -ne 0 ]; then\n  echo \"Missing required tools: ${missing[*]}\" >&2\n  echo \"Install them on the host before running this script.\" >&2\n  exit 1\nfi\n\necho \"Preparing build environment...\"\n\n# Optional: allow the builder to pre-fetch the dotfiles tarball to avoid network access\nif [ -d dots-hyprland ]; then\n  echo \"Found local dots-hyprland directory; creating tarball for mkarchiso\";\n  tar -czf root/dots-hyprland.tar.gz -C dots-hyprland . || true\nfi\n\necho \"Make sure you have run 'sudo pacman -Sw -r /tmp/hyprland_repo <packages>' to populate a local repo,\nor place a prepared repo at ${PROFILE_DIR}/airootfs/hyprland_repo. See README.md for details.\"\n\necho \"Invoking mkarchiso...\"\nmkarchiso -v -w \"$WORKDIR\" -o \"$OUTDIR\" \"$PROFILE_DIR\"\n\necho \"ISO created in $OUTDIR\" \n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":47,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","external":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","path":"/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":49,"edits":[{"text":"This directory is used as the user skeleton for the live user and for newly\ncreated users in installed systems.\n\nThe end-4 hyprland dotfiles will be copied into `/etc/skel/.config` at build\ntime by `customize_airootfs.sh`. If you want to override the dotfiles used in\nthe image, place a clone or tarball next to the build script and run the build.\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]},{"type":"create","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/README.md","external":"file:///home/ali/myarchiso/hyprland-releng-custom/README.md","path":"/home/ali/myarchiso/hyprland-releng-custom/README.md","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":51,"initialContent":"","telemetryInfo":{}},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/ali/myarchiso/hyprland-releng-custom/README.md","external":"file:///home/ali/myarchiso/hyprland-releng-custom/README.md","path":"/home/ali/myarchiso/hyprland-releng-custom/README.md","scheme":"file"},"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","epoch":53,"edits":[{"text":"# hyprland-releng-custom (archiso profile)\n\nThis folder is an archiso profile that builds a Hyprland-based live ISO.\n\nStructure (key files):\n\n- `packages.x86_64`: package list included in the image.\n- `pacman.conf`: pacman configuration template enabling the local `hyprland_iso` repo.\n- `airootfs/`: files and scripts baked into the live image.\n  - `root/customize_airootfs.sh`: executed by mkarchiso to create the `live` user and bake dotfiles.\n  - `usr/local/bin/install_end4_dotfiles.sh`: script to copy baked dotfiles into a target root.\n  - `usr/local/bin/hyprland-offline-installer`: the interactive installer (dialog-based).\n  - `usr/local/bin/start-hyprland.sh`: wrapper to launch Hyprland for the `live` user.\n  - `usr/lib/systemd/system/hyprland-live.service`: autostart Hyprland in live session.\n  - `usr/lib/systemd/system/hyprland-installer.service`: oneshot installer service.\n  - `etc/systemd/system/getty@tty1.service.d/autologin.conf`: autologin configuration.\n\nBuild instructions (host):\n\n1. Install build prerequisites on the host:\n\n```fish\nsudo pacman -S --needed archiso mkinitcpio xorriso bsdtar repo-tools grub efibootmgr\n```\n\n2. Optionally prefetch dotfiles locally:\n\n```fish\n# (optional) clone a local copy to avoid network during mkarchiso\ngit clone https://github.com/end-4/dots-hyprland dots-hyprland\n```\n\n3. Prepare an offline repository of packages (recommended):\n\nYou can populate a directory `hyprland_repo` with all required `.pkg.tar.zst`\nfiles and a repo database created with `repo-add`. The installer expects this\nto be available on the ISO at `/hyprland_repo`.\n\nExample to download packages to a temp cache:\n\n```fish\nmkdir -p /tmp/hyprland_repo\n# Use pacman -Sw to download packages to cache (host must have internet)\ncat hyprland-releng-custom/packages.x86_64 | xargs -r -n1 sudo pacman -Sw --cachedir /tmp/hyprland_repo\nrepo-add /tmp/hyprland_repo/hyprland.db.tar.gz /tmp/hyprland_repo/*.pkg.tar.zst\n```\n\nThen copy `/tmp/hyprland_repo` into `hyprland-releng-custom/airootfs/hyprland_repo` before building.\n\n4. Build the ISO:\n\n```fish\n./build.sh\n```\n\nCustomization:\n- To change the package list, edit `packages.x86_64`.\n- To update baked dotfiles, put a `dots-hyprland` directory next to `build.sh` or allow network access during the build so `git clone` in `customize_airootfs.sh` can fetch them.\n\nAuto-login and installer:\n- `getty@tty1.service.d/autologin.conf` enables autologin of the `live` user.\n- `hyprland-installer.service` is enabled in the live image (via `customize_airootfs.sh`) and will run the `hyprland-offline-installer` once on the live system.\n\nNotes & troubleshooting:\n- If you need to force offline-only behavior for building, prefetch the dotfiles tarball `root/dots-hyprland.tar.gz` and the `hyprland_repo` directory before running `mkarchiso`.\n- The installer uses `dialog` and `nmcli` (NetworkManager). Ensure these packages are installed in the profile.\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1,"endColumn":1}}]}],"epochCounter":56},"recentSnapshot":{"entries":[{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/packages.x86_64","languageId":"plaintext","originalHash":"da39a3e","currentHash":"41727aa","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/packages.x86_64?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/pacman.conf","languageId":"properties","originalHash":"da39a3e","currentHash":"111eaf0","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/pacman.conf?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/profiledef.sh","languageId":"shellscript","originalHash":"da39a3e","currentHash":"3f78e5d","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/profiledef.sh?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh","languageId":"shellscript","originalHash":"da39a3e","currentHash":"6e634dd","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/root/customize_airootfs.sh?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh","languageId":"shellscript","originalHash":"da39a3e","currentHash":"5427321","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/install_end4_dotfiles.sh?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh","languageId":"shellscript","originalHash":"da39a3e","currentHash":"bf7cd97","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/start-hyprland.sh?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer","languageId":"shellscript","originalHash":"da39a3e","currentHash":"15e8938","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/local/bin/hyprland-offline-installer?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service","languageId":"plaintext","originalHash":"da39a3e","currentHash":"aa9953c","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-live.service?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service","languageId":"plaintext","originalHash":"da39a3e","currentHash":"97dd9f0","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/usr/lib/systemd/system/hyprland-installer.service?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf","languageId":"properties","originalHash":"da39a3e","currentHash":"0486aa2","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/systemd/system/getty%40tty1.service.d/autologin.conf?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/build.sh","languageId":"shellscript","originalHash":"da39a3e","currentHash":"8b14cba","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/build.sh?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md","languageId":"markdown","originalHash":"da39a3e","currentHash":"35e4b0e","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/airootfs/etc/skel/README.md?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}},{"resource":"file:///home/ali/myarchiso/hyprland-releng-custom/README.md","languageId":"markdown","originalHash":"da39a3e","currentHash":"18ec2c3","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/ali/myarchiso/hyprland-releng-custom/README.md?%7B%22sessionId%22%3A%2260e32f90-0ac9-4c9a-9417-7e3fd32c0cf6%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2bb05cc1-ab15-4efb-9180-10303c251cd9","agentId":"github.copilot.editsAgent","modelId":"copilot/auto","modeId":"agent"}}]}}